<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      lang="en">
  <HEAD>
    <TITLE>Task Report</TITLE>

<script type="text/javascript"
	src="http://status.openstack.org/jquery.min.js"></script>
<script type="text/javascript"
	src="http://status.openstack.org/jquery-visibility.min.js"></script>
<script type="text/javascript"
	src="http://status.openstack.org/jquery-graphite.js"></script>
<script type="text/javascript"
	src="http://status.openstack.org/common.js"></script>
<script type="text/javascript"
	src="status.js"></script>

  </HEAD>

  <BODY>

    <div class="container" id="graph-container">
      <h2> Job Stats </h2>

      <script type="text/javascript">
$.fn.graphite.defaults.url = "http://graphite.openstack.org/render/";
tasks = [
    'CreateServer',
    'DeleteServer',
    'ListServers'
];

float_tasks = [
    'AddFloatingIP',
    'CreateFloatingIP',
    'DeleteFloatingIP',
    'GetFloatingIP',
    'ListFloatingIPs'
]

providers = [
    'hpcloud',
    'rax',
    'tripleo',
    'ovh'
]

jobs = [
    'gate-tempest-dsvm-full',
    'gate-tempest-dsvm-neutron-full'
]

for(i=0; i<tasks.length; ++i) {

  $("#graph-container").append($(new Image()).addClass('graph').graphite({
      from: "-72hours",
      width: 885,
      height: 495,
      bgcolor: 'ffffff',
      fgcolor: '000000',
      lineMode: 'connected',
      title: tasks[i],
      target: [
          "alias(averageSeries(stats.timers.nodepool.task.hpcloud-b*." + tasks[i] + "Task.mean), 'HP')",
          "alias(averageSeries(stats.timers.nodepool.task.ovh-gra1." + tasks[i] + "Task.mean), 'OVH')",
          "alias(averageSeries(stats.timers.nodepool.task.rax-dfw." + tasks[i] + "Task.mean), 'DFW')",
          "alias(averageSeries(stats.timers.nodepool.task.rax-iad." + tasks[i] + "Task.mean), 'IAD')",
          "alias(averageSeries(stats.timers.nodepool.task.rax-ord." + tasks[i] + "Task.mean), 'ORD')",
          "alias(averageSeries(stats.timers.nodepool.task.tripleo-test-cloud-rh1." + tasks[i] + "Task.mean), 'TripleO')"
      ]
  }));

}

for(i=0; i<float_tasks.length; ++i) {

  $("#graph-container").append($(new Image()).addClass('graph').graphite({
      from: "-72hours",
      width: 885,
      height: 495,
      bgcolor: 'ffffff',
      fgcolor: '000000',
      lineMode: 'connected',
      title: float_tasks[i],
      target: [
          "alias(averageSeries(stats.timers.nodepool.task.hpcloud-b*." + float_tasks[i] + "Task.mean), 'HP')",
          "alias(averageSeries(stats.timers.nodepool.task.tripleo-test-cloud-rh1*." + float_tasks[i] + "Task.mean), 'TripleO')"
      ]
  }));

}

  $("#graph-container").append($(new Image()).addClass('graph').graphite({
      from: "-72hours",
      width: 885,
      height: 495,
      bgcolor: 'ffffff',
      fgcolor: '000000',
      lineMode: 'connected',
      title: 'Time to SSH Ready',
      target: [
          "alias(averageSeries(stats.timers.nodepool.launch.provider.hpcloud-b*.ready.mean), 'HP')",
          "alias(averageSeries(stats.timers.nodepool.launch.provider.rax-dfw.ready.mean), 'RAX DFW')",
          "alias(averageSeries(stats.timers.nodepool.launch.provider.rax-iad.ready.mean), 'RAX IAD')",
          "alias(averageSeries(stats.timers.nodepool.launch.provider.rax-ord.ready.mean), 'RAX ORD')",
          "alias(averageSeries(stats.timers.nodepool.launch.provider.tripleo-test-cloud-rh1.ready.mean), 'TripleO')"
      ]
  }));


for(i=0; i<providers.length; ++i) {
  $("#graph-container").append($(new Image()).addClass('graph').graphite({
      from: "-72hours",
      width: 885,
      height: 495,
      bgcolor: 'ffffff',
      fgcolor: '000000',
      areaMode: 'stacked',
      title: providers[i] + " success rate",
      target: [
         "color(alias(summarize(sumSeries(stats_counts.nodepool.launch.provider." + providers[i] + "*.ready), '1h'), 'Ready'), '00ff22')",
         "color(alias(summarize(sumSeries(stats_counts.nodepool.launch.provider." + providers[i] + "*.error.*), '1h'), 'Ready'), 'ff0000')"
      ]
  }));

}

for(i=0; i<jobs.length; ++i) {
  $("#graph-container").append($(new Image()).addClass('graph').graphite({
      from: "-72hours",
      width: 885,
      height: 495,
      bgcolor: 'ffffff',
      fgcolor: '000000',
      lineMode: 'connected',
      title: jobs[i] + ' job runtime',
      target: [
          "alias(averageSeries(stats.timers.nodepool.job." + jobs[i] + ".master.*.hpcloud-b*.runtime.mean), 'HP')",
          "alias(averageSeries(stats.timers.nodepool.job." + jobs[i] + ".master.*.rax-dfw.runtime.mean), 'RAX DFW')",
          "alias(averageSeries(stats.timers.nodepool.job." + jobs[i] + ".master.*.rax-iad.runtime.mean), 'RAX IAD')",
          "alias(averageSeries(stats.timers.nodepool.job." + jobs[i] + ".master.*.rax-ord.runtime.mean), 'RAX ORD')"
      ]
  }));
}

      </script>
    </div>

  </BODY>
</html>
